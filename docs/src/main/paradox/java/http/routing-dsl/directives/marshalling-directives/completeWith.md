<a id="completewith-java"></a>
# completeWith

## Description

Uses the marshaller for a given type to produce a completion function that is passed to its
inner route.  You can use it to decouple marshaller resolution from request completion.

The `completeWith` directive works in conjunction with `instanceOf` and `spray.httpx.marshalling`
to convert higher-level (object) structure into some lower-level serialized "wire format".
@ref[The marshalling documentation](../../../common/marshalling.md#http-marshalling-java) explains this process in detail.
This directive simplifies exposing types to clients via a route while providing some
form of access to the current context.

`completeWith` is similar to `handleWith`.  The main difference is with `completeWith` you must eventually call
the completion function generated by `completeWith`.  `handleWith` will automatically call `complete` when the
`handleWith` function returns.

## Examples

The following example uses @ref[Json Support via Jackson](../../../common/json-support.md#json-jackson-support-java) to marshall a simple `Person` into a json request   

@@snip [MarshallingDirectivesExamplesTest.java](../../../../../../../test/java/docs/http/javadsl/server/directives/MarshallingDirectivesExamplesTest.java) { #person }

@@snip [MarshallingDirectivesExamplesTest.java](../../../../../../../test/java/docs/http/javadsl/server/directives/MarshallingDirectivesExamplesTest.java) { #example-completeWith-with-json }

The `findPerson` takes an argument of type `Consumer<Consumer<Person>>` which is generated by the `completeWith`
call.  We can handle any logic we want in `findPerson` and call our completion function to
complete the request.
