#
# Run the "database" trace (DS1) from the authors of the ARC algorithm.
#
# Nimrod Megiddo and Dharmendra S. Modha, "ARC: A Self-Tuning, Low Overhead Replacement Cache".
#
# Download traces from the author's home page:
# https://researcher.watson.ibm.com/researcher/view_person_subpage.php?id=4700
#
# > akka-cluster-sharding/Test/runMain akka.cluster.sharding.passivation.simulator.Simulator arc-trace-database
#
#   ╔════════╤═════════╤════════════╤═════════════╤══════════════╗
#   ║    Run │  Active │   Accesses │ Activations │ Passivations ║
#   ╠════════╪═════════╪════════════╪═════════════╪══════════════╣
#   ║ LRU 1M │  3.09 % │ 43,704,979 │  42,356,500 │   41,356,500 ║
#   ╟────────┼─────────┼────────────┼─────────────┼──────────────╢
#   ║ LRU 2M │ 10.75 % │ 43,704,979 │  39,007,141 │   37,007,141 ║
#   ╟────────┼─────────┼────────────┼─────────────┼──────────────╢
#   ║ LRU 4M │ 20.24 % │ 43,704,979 │  34,857,131 │   30,857,131 ║
#   ╟────────┼─────────┼────────────┼─────────────┼──────────────╢
#   ║ LRU 8M │ 43.03 % │ 43,704,979 │  24,896,638 │   16,896,638 ║
#   ╚════════╧═════════╧════════════╧═════════════╧══════════════╝
#

arc-traces="arc-traces"
arc-traces=${?ARC_TRACES}

akka.cluster.sharding {
  passivation.simulator {
    runs = [
      {
        name = "LRU 1M"
        shards = 100
        regions = 10
        pattern = arc-database
        strategy = lru-100k
      },
      {
        name = "LRU 2M"
        shards = 100
        regions = 10
        pattern = arc-database
        strategy = lru-200k
      },
      {
        name = "LRU 4M"
        shards = 100
        regions = 10
        pattern = arc-database
        strategy = lru-400k
      },
      {
        name = "LRU 8M"
        shards = 100
        regions = 10
        pattern = arc-database
        strategy = lru-800k
      }
    ]

    print-detailed-stats = true

    arc-database {
      pattern = trace
      trace {
        format = arc
        path = ${arc-traces}"/DS1.lis"
      }
    }

    lru-100k {
      strategy = least-recently-used
      least-recently-used {
        per-region-limit = 100000
      }
    }

    lru-200k {
      strategy = least-recently-used
      least-recently-used {
        per-region-limit = 200000
      }
    }

    lru-400k {
      strategy = least-recently-used
      least-recently-used {
        per-region-limit = 400000
      }
    }

    lru-800k {
      strategy = least-recently-used
      least-recently-used {
        per-region-limit = 800000
      }
    }
  }
}
